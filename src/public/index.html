<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>企业微信AI客服消息系统后端</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gradient-to-br from-blue-50 to-indigo-50">
    <div class="min-h-screen">
      <!-- 导航栏 -->
      <nav class="bg-white/80 backdrop-blur-sm border-b border-gray-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between h-16">
            <div class="flex items-center">
              <span class="text-xl font-semibold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent"> 企业微信AI客服消息系统后端 </span>
            </div>
            <div class="flex items-center space-x-4">
              <div class="flex items-center space-x-2">
                <div class="h-2 w-2 bg-green-400 rounded-full animate-pulse"></div>
                <span class="text-sm text-gray-600">系统运行中</span>
              </div>
            </div>
          </div>
        </div>
      </nav>

      <!-- 主要内容 -->
      <main class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
          <!-- 状态卡片 1 -->
          <div
            class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl shadow-blue-100/50 overflow-hidden hover:shadow-2xl hover:scale-105 transition-all duration-300"
          >
            <div class="p-6">
              <div class="flex items-center justify-between mb-8">
                <div class="flex items-center space-x-3">
                  <div class="p-3 bg-blue-100 rounded-xl">
                    <svg class="h-6 w-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                    </svg>
                  </div>
                  <div>
                    <h3 class="text-lg font-semibold text-gray-800">系统状态</h3>
                    <p class="text-sm text-gray-500">运行状态良好</p>
                  </div>
                </div>
                <div class="flex-shrink-0">
                  <span class="inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium bg-green-100 text-green-800 ring-1 ring-green-200">
                    <div class="h-2 w-2 bg-green-500 rounded-full mr-2"></div>
                    正常
                  </span>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-4">
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200">
                  <div class="text-sm text-blue-600 font-medium mb-2">服务地址/端口</div>
                  <div class="flex items-baseline">
                    <div class="text-2xl font-semibold text-blue-700" id="port">3000</div>
                    <div class="ml-2 text-xs text-blue-500">TCP/IP</div>
                  </div>
                </div>
                <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200">
                  <div class="text-sm text-blue-600 font-medium mb-2">运行环境</div>
                  <div class="flex items-baseline">
                    <div class="text-2xl font-semibold text-blue-700" id="env">生产</div>
                    <div class="ml-2 text-xs text-blue-500">MODE</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- 配置提醒卡片 -->
          <div
            class="bg-white/70 backdrop-blur-sm rounded-2xl shadow-xl shadow-purple-100/50 overflow-hidden hover:shadow-2xl hover:scale-105 transition-all duration-300"
          >
            <div class="p-6">
              <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                  <div class="p-3 bg-purple-100 rounded-xl">
                    <svg class="h-6 w-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                  </div>
                  <div>
                    <h3 class="text-lg font-semibold text-gray-800">回调配置说明</h3>
                    <p class="text-sm text-gray-500">请在企业微信管理后台配置</p>
                  </div>
                </div>
              </div>
              <div class="mt-6 space-y-4">
                <div class="bg-purple-50 rounded-xl p-4">
                  <div class="text-sm text-purple-600 font-medium">回调URL</div>
                  <div class="mt-1 text-sm font-mono bg-white/50 p-2 rounded-lg break-all" id="callbackUrl">正在获取...</div>
                </div>
                <div class="bg-yellow-50 rounded-xl p-4">
                  <div class="text-sm text-yellow-800 font-medium">重要提醒</div>
                  <div class="mt-2 text-sm text-yellow-700">
                    请确保以下配置与企业微信管理后台保持一致：
                    <ul class="list-disc list-inside mt-2 space-y-1">
                      <li>Token</li>
                      <li>EncodingAESKey</li>
                    </ul>
                  </div>
                </div>
                <div class="bg-indigo-50 rounded-xl p-4">
                  <div class="text-sm text-indigo-600 font-medium">相关链接</div>
                  <div class="mt-2 space-y-2">
                    <a
                      href="https://kf.weixin.qq.com/api/doc/path/93304"
                      target="_blank"
                      class="block text-sm text-indigo-600 hover:text-indigo-800 hover:underline"
                    >
                      📚 微信客服API文档
                    </a>
                    <a href="https://kf.weixin.qq.com/" target="_blank" class="block text-sm text-indigo-600 hover:text-indigo-800 hover:underline">
                      ⚙️ 微信客服管理后台入口
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // 获取当前URL信息
      const getUrlInfo = () => {
        const url = new URL(window.location.href)
        const port = url.port
        const host = url.hostname
        return {
          // 如果有端口就显示端口，没有就显示域名/IP
          displayValue: port || host,
          // 完整的回调URL
          callbackUrl: `${url.protocol}//${url.host}/api/wecom/callback`,
        }
      }

      // 获取健康状态
      fetch('/health')
        .then(response => response.json())
        .then(data => {
          if (data.status === 'ok') {
            document.getElementById('env').textContent = window.location.hostname === 'localhost' ? '开发' : '生产'
          }
        })
        .catch(error => {
          console.error('健康检查失败:', error)
          document.getElementById('env').textContent = '检查失败'
        })

      // 更新URL相关信息
      const urlInfo = getUrlInfo()
      document.getElementById('port').textContent = urlInfo.displayValue
      document.getElementById('callbackUrl').textContent = urlInfo.callbackUrl
    </script>
  </body>
</html>
